(this.webpackJsonpdrawable_canvas=this.webpackJsonpdrawable_canvas||[]).push([[0],{20:function(t,e,n){t.exports={enabled:"CanvasToolbar_enabled__3TpTG",disabled:"CanvasToolbar_disabled__3UBkF",invertx:"CanvasToolbar_invertx__16CVq"}},21:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAwwAAAMMBnc7+MwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEFSURBVEiJ7dSxLkRBFMbx31BIlkQlHoCap5BQLAXvQafV6DyLRLYSdkWv0dBQ0NAKkUhkj2bEzc3udW9xE5E9yVfNd85/5pyZSRGhzZhqtfoE8DcAKaVOqwD0mkBSSnNNAAmBAboR8V4qtoguVrNWMI9n3Gad4SQqHlRk9dHJvmns4qWwXqUrbESEspSMfazhekyhN9zhc8z6KWarAKN0jm0sI+WkmdyuPTyV/JdFSBXgATujjl3aYQf7+CjkXhTaPRYw+DbVETZLkMM6Leo3hGxhmHNfsVBnBk0hx4XcozqARpA8/GG+bQcJ6+rFTUQ81jGmlJYi4p6fa9da/IPvegL4Lb4A0uc9nRaYXwcAAAAASUVORK5CYII="},26:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAhQAAAIUB4uz/wQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHUSURBVEiJtda9ahRRFAfw3xHFJCabFEkawcYiYKMWVmohBHwFOwsfQLCxthOENHZqKxZG8DHSxcJC0Qcw7AqSNSoGci3mznp3nP0K8cBlZs7X/5z//RopJeMGlrGL1Bi7WJ4Uf9pk2cQVPMDPrJvHVra9GRc8BBARS7iKU4X6cn5+wvf8vljbIuJr4XuEdyml/YGmoGIdX/xLxayji/U2iu5iJXfwa1zbY2QOOznXE4YpuoE93D5m8lr2cLMN4BWu4TF+4HDGxIEOeng90DaW5BkVj/fyd6dhP4u5hq6Tnxdz7GZpL1eLlNIhvmEtq7Yj4mHhsoWng5Ir23b+rGO6Zc62fdAtnFewUdjOqyaylo3sMxJgqIMsvcJ5X8XrKFlCvwHQmwRQdjArwH5K6fc0AKvHAFjVoGcUwCwUdbKPHNNrOpw0RVN10MVCRCz8T4A6oI/FiIiTBKh5XFN1EDnRkETEnGrnH2sOSoC60rbqoR8R8zg3bQe102oB0DYPAwB/l/VkgJTSgeo+KDtoA6h1fSN2Me1nUV3JOj7iOT5k/csi5jNe4D2uj+og8lE7rIx4hjt4hIMRRZRyX7UYLqWUjoYsI35VLuCt6tKZ5h7ewa22XH8AgjMTispa6ucAAAAASUVORK5CYII="},27:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEYSURBVEiJ7dS9SgNBFMXxX0y0NNpLqjQiKRRETON7aBMfwLfxDcRGC8HOTm21s7RIYZdniGiRO+6y5mNXVxD0wMBw58z532Fnh1+kFq5jNH8C0MFbjE7ZTUsVAEsz5rUBvqR/wB8CNLFeY+5aZH4ArjDCXsHYNv+vbWK1UNuNrMs8oGfyFGzmjDthvA9QUe1YG4U3aQvL2M4DpqkRHfZxU4C0o9aPxhpzcsDQ5I0ZFOpHGMfas+wtSvNxePIaxNpw0QngHIcR1M3Vu3jFcXhmqsw1vZCdJCmFny3a3CoBSBAm3TbKhlcBJEj6Vo9lN1UBwENF/yfAAVaqhhS0P614J7uCdY1bsh+kh1NsfLP7pBec4KmmvNl6B0BuQt0zCQ0xAAAAAElFTkSuQmCC"},28:function(t,e,n){t.exports=n(45)},40:function(t,e){},41:function(t,e){},42:function(t,e){},44:function(t,e,n){},45:function(t,e,n){"use strict";n.r(e);var o=n(8),a=n.n(o),i=n(24),r=n.n(i),s=n(7),c=n(9),u=n(17),l=n(10),h=n(14),f=n(20),d=n.n(f),v=n(26),b=n.n(v),k=n(21),S=n.n(k),m=n(27),A=n.n(m),g=function(t){var e=t.imgUrl,n=t.altText,o=t.invertX,i=t.size,r=t.enabled,s=t.clickCallback;return a.a.createElement("img",{src:e,className:"\n    ".concat(r?d.a.enabled:d.a.disabled," ").concat(o?"":d.a.invertx,"\n    "),alt:n,title:n,height:"".concat(i,"px"),width:"".concat(i,"px"),onClick:s})};g.defaultProps={invertX:!1};var C=function(t){var e=t.topPosition,n=(t.leftPosition,t.canUndo),o=t.canRedo,i=t.downloadCallback,r=t.undoCallback,s=t.redoCallback,c=t.resetCallback,u=[{imgUrl:A.a,altText:"Send to Streamlit",invertX:!1,enabled:!0,clickCallback:i},{imgUrl:S.a,altText:"Undo",invertX:!0,enabled:n,clickCallback:n?r:function(){}},{imgUrl:S.a,altText:"Redo",invertX:!1,enabled:o,clickCallback:o?s:function(){}},{imgUrl:b.a,altText:"Reset canvas & history",invertX:!1,enabled:!0,clickCallback:c}];return a.a.createElement("div",{style:{position:"absolute",top:e+4,left:0,display:"flex",gap:4,zIndex:20}},u.map((function(t){return a.a.createElement(g,{key:t.altText,imgUrl:t.imgUrl,altText:t.altText,invertX:t.invertX,size:24,enabled:t.enabled,clickCallback:t.clickCallback})})))},w=function(t){var e=Object(o.useState)(new l.fabric.Canvas("")),n=Object(c.a)(e,2),i=n[0],r=n[1],s=function(t,e){var n=Object(o.useState)(t),a=Object(c.a)(n,2),i=a[0],r=a[1];return Object(o.useEffect)((function(){var n=setTimeout((function(){r(t)}),e);return function(){clearTimeout(n)}}),[t,e]),i}(t.stateToSendToStreamlit,200);return Object(o.useEffect)((function(){var t=new l.fabric.Canvas("canvas-to-streamlit",{enableRetinaScaling:!1});r(t)}),[]),Object(o.useEffect)((function(){s&&t.shouldSendToStreamlit&&i.loadFromJSON(s,(function(){!function(t){var e=t.getContext().canvas.toDataURL();u.a.setComponentValue({data:e,width:t.getWidth(),height:t.getHeight(),raw:t.toObject(["selected"])})}(i)}))}),[i,t.shouldSendToStreamlit,s]),a.a.createElement("canvas",{id:"canvas-to-streamlit",width:t.canvasWidth,height:t.canvasHeight})},y=n(5),O={shouldReloadCanvas:!1,forceSendToStreamlit:!1},p={shouldReloadCanvas:!0,forceSendToStreamlit:!1},j={shouldReloadCanvas:!1,forceSendToStreamlit:!0},M={shouldReloadCanvas:!0,forceSendToStreamlit:!0},_=function(t,e){switch(e.type){case"save":if(e.state){if(Object(h.isEmpty)(t.currentState))return console.log("AARON - empty currentState"),{history:{undoStack:[],redoStack:[]},action:Object(s.a)({},O),initialState:e.state,currentState:e.state};if(Object(h.isEqual)(e.state,t.currentState))return{history:Object(s.a)({},t.history),action:Object(s.a)({},O),initialState:t.initialState,currentState:t.currentState};var n=t.history.undoStack.length>=100;return{history:{undoStack:[].concat(Object(y.a)(t.history.undoStack.slice(n?1:0)),[t.currentState]),redoStack:[]},action:Object(s.a)({},O),initialState:null==t.initialState?t.currentState:t.initialState,currentState:e.state}}throw new Error("No action state to save");case"undo":if(Object(h.isEmpty)(t.currentState)||Object(h.isEqual)(t.initialState,t.currentState))return{history:Object(s.a)({},t.history),action:Object(s.a)({},O),initialState:t.initialState,currentState:t.currentState};var o=0===t.history.undoStack.length;return{history:{undoStack:t.history.undoStack.slice(0,-1),redoStack:[].concat(Object(y.a)(t.history.redoStack),[t.currentState])},action:Object(s.a)({},p),initialState:t.initialState,currentState:o?t.currentState:t.history.undoStack[t.history.undoStack.length-1]};case"redo":return t.history.redoStack.length>0?{history:{undoStack:[].concat(Object(y.a)(t.history.undoStack),[t.currentState]),redoStack:t.history.redoStack.slice(0,-1)},action:Object(s.a)({},p),initialState:t.initialState,currentState:t.history.redoStack[t.history.redoStack.length-1]}:{history:Object(s.a)({},t.history),action:Object(s.a)({},O),initialState:t.initialState,currentState:t.currentState};case"reset":if(!e.state)throw new Error("No action state to store in reset");return{history:{undoStack:[],redoStack:[]},action:Object(s.a)({},M),initialState:e.state,currentState:e.state};case"forceSendToStreamlit":return{history:Object(s.a)({},t.history),action:Object(s.a)({},j),initialState:t.initialState,currentState:t.currentState};default:throw new Error("TS should protect from this")}},R={history:{undoStack:[],redoStack:[]},action:{forceSendToStreamlit:!1,shouldReloadCanvas:!1},initialState:{},currentState:{}},x=Object(o.createContext)({}),E=function(t){var e=t.children,n=Object(o.useReducer)(_,R),i=Object(c.a)(n,2),r=i[0],s=i[1],u=Object(o.useCallback)((function(t){return s({type:"save",state:t})}),[s]),l=Object(o.useCallback)((function(){return s({type:"undo"})}),[s]),h=Object(o.useCallback)((function(){return s({type:"redo"})}),[s]),f=Object(o.useCallback)((function(){return s({type:"forceSendToStreamlit"})}),[s]),d=Object(o.useCallback)((function(t){return s({type:"reset",state:t})}),[s]),v=0!==r.history.undoStack.length,b=0!==r.history.redoStack.length;return a.a.createElement(x.Provider,{value:{canvasState:r,saveState:u,undo:l,redo:h,canUndo:v,canRedo:b,forceStreamlitUpdate:f,resetState:d}},e)},D=n(0),U=n(1),L=n(2),B=n(3),X=Object(U.a)((function t(e){Object(D.a)(this,t),this._canvas=void 0,this._canvas=e})),Y={circle:function(t){Object(L.a)(n,t);var e=Object(B.a)(n);function n(){var t;Object(D.a)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).isMouseDown=!1,t.fillColor="#ffffff",t.strokeWidth=10,t.strokeColor="#ffffff",t.currentCircle=new l.fabric.Circle,t.currentStartX=0,t.currentStartY=0,t._minRadius=10,t.linearDistance=function(t,e){var n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)},t}return Object(U.a)(n,[{key:"configureCanvas",value:function(t){var e=this,n=t.strokeWidth,o=t.strokeColor,a=t.fillColor;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject((function(t){return t.selectable=t.evented=!1})),this.strokeWidth=n,this.strokeColor=o,this.fillColor=a,this._minRadius=n,this._canvas.on("mouse:down",(function(t){return e.onMouseDown(t)})),this._canvas.on("mouse:move",(function(t){return e.onMouseMove(t)})),this._canvas.on("mouse:up",(function(t){return e.onMouseUp(t)})),this._canvas.on("mouse:out",(function(t){return e.onMouseOut(t)})),function(){e._canvas.off("mouse:down"),e._canvas.off("mouse:move"),e._canvas.off("mouse:up"),e._canvas.off("mouse:out")}}},{key:"onMouseDown",value:function(t){var e=this._canvas,n=t.e.button;this.isMouseDown=!0;var o=e.getPointer(t.e);this.currentStartX=o.x,this.currentStartY=o.y,this.currentCircle=new l.fabric.Circle({left:this.currentStartX,top:this.currentStartY,originX:"left",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.fillColor,selectable:!1,evented:!1,radius:this._minRadius}),0===n&&e.add(this.currentCircle)}},{key:"onMouseMove",value:function(t){if(this.isMouseDown){var e=this._canvas,n=e.getPointer(t.e),o=this.linearDistance({x:this.currentStartX,y:this.currentStartY},{x:n.x,y:n.y})/2;this.currentCircle.set({radius:Math.max(o,this._minRadius),angle:180*Math.atan2(n.y-this.currentStartY,n.x-this.currentStartX)/Math.PI}),this.currentCircle.setCoords(),e.renderAll()}}},{key:"onMouseUp",value:function(t){this.isMouseDown=!1}},{key:"onMouseOut",value:function(t){this.isMouseDown=!1}}]),n}(X),freedraw:function(t){Object(L.a)(n,t);var e=Object(B.a)(n);function n(){return Object(D.a)(this,n),e.apply(this,arguments)}return Object(U.a)(n,[{key:"configureCanvas",value:function(t){var e=t.strokeWidth,n=t.strokeColor;return this._canvas.isDrawingMode=!0,this._canvas.freeDrawingBrush.width=e,this._canvas.freeDrawingBrush.color=n,function(){}}}]),n}(X),line:function(t){Object(L.a)(n,t);var e=Object(B.a)(n);function n(){var t;Object(D.a)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).isMouseDown=!1,t.strokeWidth=10,t.strokeColor="#ffffff",t.currentLine=new l.fabric.Line,t}return Object(U.a)(n,[{key:"configureCanvas",value:function(t){var e=this,n=t.strokeWidth,o=t.strokeColor;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject((function(t){return t.selectable=t.evented=!1})),this.strokeWidth=n,this.strokeColor=o,this._canvas.on("mouse:down",(function(t){return e.onMouseDown(t)})),this._canvas.on("mouse:move",(function(t){return e.onMouseMove(t)})),this._canvas.on("mouse:up",(function(t){return e.onMouseUp(t)})),this._canvas.on("mouse:out",(function(t){return e.onMouseOut(t)})),function(){e._canvas.off("mouse:down"),e._canvas.off("mouse:move"),e._canvas.off("mouse:up"),e._canvas.off("mouse:out")}}},{key:"onMouseDown",value:function(t){var e=this._canvas,n=t.e.button;this.isMouseDown=!0;var o=e.getPointer(t.e),a=[o.x,o.y,o.x,o.y];this.currentLine=new l.fabric.Line(a,{strokeWidth:this.strokeWidth,fill:this.strokeColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),0===n&&e.add(this.currentLine)}},{key:"onMouseMove",value:function(t){if(this.isMouseDown){var e=this._canvas,n=e.getPointer(t.e);this.currentLine.set({x2:n.x,y2:n.y}),this.currentLine.setCoords(),e.renderAll()}}},{key:"onMouseUp",value:function(t){this.isMouseDown=!1;var e=this._canvas;0===this.currentLine.width&&0===this.currentLine.height&&e.remove(this.currentLine)}},{key:"onMouseOut",value:function(t){this.isMouseDown=!1}}]),n}(X),polygon:function(t){Object(L.a)(n,t);var e=Object(B.a)(n);function n(){var t;Object(D.a)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).isMouseDown=!1,t.fillColor="#ffffff",t.strokeWidth=10,t.strokeColor="#ffffff",t.startCircle=new l.fabric.Circle,t.currentLine=new l.fabric.Line,t.currentPath=new l.fabric.Path,t._pathString="M ",t}return Object(U.a)(n,[{key:"configureCanvas",value:function(t){var e=this,n=t.strokeWidth,o=t.strokeColor,a=t.fillColor;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject((function(t){return t.selectable=t.evented=!1})),this.strokeWidth=n,this.strokeColor=o,this.fillColor=a,this._canvas.on("mouse:down",(function(t){return e.onMouseDown(t)})),this._canvas.on("mouse:move",(function(t){return e.onMouseMove(t)})),this._canvas.on("mouse:up",(function(t){return e.onMouseUp(t)})),this._canvas.on("mouse:out",(function(t){return e.onMouseOut(t)})),this._canvas.on("mouse:dblclick",(function(t){return e.onMouseDoubleClick(t)})),function(){e._canvas.off("mouse:down"),e._canvas.off("mouse:move"),e._canvas.off("mouse:up"),e._canvas.off("mouse:out"),e._canvas.off("mouse:dblclick")}}},{key:"onMouseDown",value:function(t){var e=this._canvas,n=t.e.button,o=!1;"M "===this._pathString&&(o=!0),this.isMouseDown=!0;var a=e.getPointer(t.e),i=[a.x,a.y,a.x,a.y];e.remove(this.currentLine),this.currentLine=new l.fabric.Line(i,{strokeWidth:this.strokeWidth,fill:this.strokeColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),0===n&&e.add(this.currentLine),o&&0===n?(this._pathString+="".concat(a.x," ").concat(a.y," "),this.startCircle=new l.fabric.Circle({left:a.x,top:a.y,originX:"center",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.strokeColor,selectable:!1,evented:!1,radius:this.strokeWidth}),e.add(this.startCircle),o=!1):(e.remove(this.currentPath),0===n&&(this._pathString+="L ".concat(a.x," ").concat(a.y," ")),2===n&&(this._pathString+="z",e.remove(this.startCircle))),this.currentPath=new l.fabric.Path(this._pathString,{strokeWidth:this.strokeWidth,fill:this.fillColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),0!==this.currentPath.width&&0!==this.currentPath.height&&e.add(this.currentPath),2===n&&(this._pathString="M ")}},{key:"onMouseMove",value:function(t){if(this.isMouseDown){var e=this._canvas,n=e.getPointer(t.e);this.currentLine.set({x2:n.x,y2:n.y}),this.currentLine.setCoords(),e.renderAll()}}},{key:"onMouseUp",value:function(t){this.isMouseDown=!0}},{key:"onMouseOut",value:function(t){this.isMouseDown=!1}},{key:"onMouseDoubleClick",value:function(t){for(var e=this._canvas,n=0;n<3;n++){var o=this._pathString.lastIndexOf("L");-1===o?(this._pathString="M ",e.remove(this.startCircle)):this._pathString=this._pathString.slice(0,o)}e.remove(this.currentLine),e.remove(this.currentPath),this.currentPath=new l.fabric.Path(this._pathString,{strokeWidth:this.strokeWidth,fill:this.fillColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),e.add(this.currentPath)}}]),n}(X),rect:function(t){Object(L.a)(n,t);var e=Object(B.a)(n);function n(){var t;Object(D.a)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).isMouseDown=!1,t.fillColor="#ffffff",t.strokeWidth=10,t.strokeColor="#ffffff",t.currentRect=new l.fabric.Rect,t.currentStartX=0,t.currentStartY=0,t._minLength=10,t}return Object(U.a)(n,[{key:"configureCanvas",value:function(t){var e=this,n=t.strokeWidth,o=t.strokeColor,a=t.fillColor;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject((function(t){return t.selectable=t.evented=!1})),this.strokeWidth=n,this.strokeColor=o,this.fillColor=a,this._minLength=n,this._canvas.on("mouse:down",(function(t){return e.onMouseDown(t)})),this._canvas.on("mouse:move",(function(t){return e.onMouseMove(t)})),this._canvas.on("mouse:up",(function(t){return e.onMouseUp(t)})),this._canvas.on("mouse:out",(function(t){return e.onMouseOut(t)})),function(){e._canvas.off("mouse:down"),e._canvas.off("mouse:move"),e._canvas.off("mouse:up"),e._canvas.off("mouse:out")}}},{key:"onMouseDown",value:function(t){var e=this._canvas,n=t.e.button;this.isMouseDown=!0;var o=e.getPointer(t.e);this.currentStartX=o.x,this.currentStartY=o.y,this.currentRect=new l.fabric.Rect({left:this.currentStartX,top:this.currentStartY,originX:"left",originY:"top",width:this._minLength,height:this._minLength,stroke:this.strokeColor,strokeWidth:this.strokeWidth,fill:this.fillColor,transparentCorners:!1,selectable:!1,evented:!1,strokeUniform:!0,noScaleCache:!1,angle:0}),0===n&&e.add(this.currentRect)}},{key:"onMouseMove",value:function(t){if(this.isMouseDown){var e=this._canvas,n=e.getPointer(t.e);this.currentStartX>n.x&&this.currentRect.set({left:Math.abs(n.x)}),this.currentStartY>n.y&&this.currentRect.set({top:Math.abs(n.y)});var o=Math.abs(this.currentStartX-n.x),a=Math.abs(this.currentStartY-n.y);this.currentRect.set({width:Math.max(o,2*this._minLength),height:Math.max(a,2*this._minLength)}),this.currentRect.setCoords(),e.renderAll()}}},{key:"onMouseUp",value:function(t){this.isMouseDown=!1}},{key:"onMouseOut",value:function(t){this.isMouseDown=!1}}]),n}(X),transform:function(t){Object(L.a)(n,t);var e=Object(B.a)(n);function n(){return Object(D.a)(this,n),e.apply(this,arguments)}return Object(U.a)(n,[{key:"configureCanvas",value:function(t){var e=this._canvas;e.isDrawingMode=!1,e.selection=!0,e.forEachObject((function(t){return t.selectable=t.evented=!0}));var n=function(){e.remove(e.getActiveObject())};return e.on("mouse:dblclick",n),function(){e.off("mouse:dblclick",n)}}}]),n}(X),point:function(t){Object(L.a)(n,t);var e=Object(B.a)(n);function n(){var t;Object(D.a)(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).isMouseDown=!1,t.fillColor="#ffffff",t.strokeWidth=10,t.strokeColor="#ffffff",t.currentCircle=new l.fabric.Circle,t.currentStartX=0,t.currentStartY=0,t.displayRadius=1,t}return Object(U.a)(n,[{key:"configureCanvas",value:function(t){var e=this,n=t.strokeWidth,o=t.strokeColor,a=t.fillColor,i=t.displayRadius;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject((function(t){return t.selectable=t.evented=!1})),this.strokeWidth=n,this.strokeColor=o,this.fillColor=a,this.displayRadius=i,this._canvas.on("mouse:down",(function(t){return e.onMouseDown(t)})),this._canvas.on("mouse:move",(function(t){return e.onMouseMove(t)})),this._canvas.on("mouse:up",(function(t){return e.onMouseUp(t)})),this._canvas.on("mouse:out",(function(t){return e.onMouseOut(t)})),function(){e._canvas.off("mouse:down"),e._canvas.off("mouse:move"),e._canvas.off("mouse:up"),e._canvas.off("mouse:out")}}},{key:"onMouseDown",value:function(t){var e=this._canvas,n=t.e.button;this.isMouseDown=!0;var o=e.getPointer(t.e);this.currentStartX=o.x-(this.displayRadius+this.strokeWidth/2),this.currentStartY=o.y,this.currentCircle=new l.fabric.Circle({left:this.currentStartX,top:this.currentStartY,originX:"left",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.fillColor,selectable:!1,evented:!1,radius:this.displayRadius}),0===n&&e.add(this.currentCircle)}},{key:"onMouseMove",value:function(t){if(this.isMouseDown){var e=this._canvas;this.currentCircle.setCoords(),e.renderAll()}}},{key:"onMouseUp",value:function(t){this.isMouseDown=!1}},{key:"onMouseOut",value:function(t){this.isMouseDown=!1}}]),n}(X),select:function(t){Object(L.a)(n,t);var e=Object(B.a)(n);function n(){return Object(D.a)(this,n),e.apply(this,arguments)}return Object(U.a)(n,[{key:"configureCanvas",value:function(t){var e=this._canvas;e.isDrawingMode=!1,e.selection=!0,e.forEachObject((function(t){return t.selectable=t.evented=!0}));var n=function(n,o,a){if(!n)return n;console.log(a,n);e.getObjects().indexOf(n);return o?(n.setControlVisible("mtr",!1),n.set("fill",t.selectFillColor)):(n.setControlVisible("mtr",!0),n.set("fill","rgba(255, 255, 255, 0.1)")),n.lockMovementX=o,n.lockMovementY=o,n.lockRotation=o,n.lockScalingX=o,n.lockScalingY=o,n.lockScalingFlip=o,n.lockSkewingX=o,n.lockSkewingY=o,n},o=function(t){console.log("e",t),t.deselected.length&&t.deselected[0].set("fill","rgba(255, 255, 255, 0.0)");var o=e.getActiveObject();n(o,!0,"SINGLE SELECT")},a=function(t){var o=e.getActiveObject();n(o,!1,"CLEARED")},i=function(t){var o=e.getActiveObject();n(o,!0,"CREATED")};return e.on("selection:created",i),e.on("selection:updated",o),e.on("before:selection:cleared",a),function(){e.off("selection:created",i),e.off("selection:updated",o),e.off("before:selection:cleared",a)}}}]),n}(X)},W=Object(u.b)((function(t){var e=t.args,n=e.canvasWidth,i=e.canvasHeight,r=e.backgroundColor,f=e.backgroundImageURL,d=e.realtimeUpdateStreamlit,v=e.drawingMode,b=e.fillColor,k=e.strokeWidth,S=e.strokeColor,m=e.displayRadius,A=e.initialDrawing,g=e.displayToolbar,y=e.selectFillColor,O=Object(o.useState)(new l.fabric.Canvas("")),p=Object(c.a)(O,2),j=p[0],M=p[1];j.stopContextMenu=!0,j.fireRightClick=!0;var _=Object(o.useState)(new l.fabric.StaticCanvas("")),R=Object(c.a)(_,2),E=R[0],D=R[1],U=Object(o.useContext)(x),L=U.canvasState,B=L.action,X=B.shouldReloadCanvas,W=B.forceSendToStreamlit,N=L.currentState,T=L.initialState,P=U.saveState,I=U.undo,V=U.redo,F=U.canUndo,H=U.canRedo,z=U.forceStreamlitUpdate,Q=U.resetState;return Object(o.useEffect)((function(){l.fabric.Object.prototype.set({});var t=new l.fabric.Canvas("canvas",{enableRetinaScaling:!1}),e=new l.fabric.StaticCanvas("backgroundimage-canvas",{enableRetinaScaling:!1});M(t),D(e),u.a.setFrameHeight()}),[]),Object(o.useEffect)((function(){Object(h.isEqual)(T,A)||j.loadFromJSON(A,(function(){j.renderAll(),Q(A)}))}),[j,A,T,Q]),Object(o.useEffect)((function(){if(f){var t=new Image;t.onload=function(){E.getContext().drawImage(t,0,0)},t.src=f}}),[j,E,i,n,r,f,P]),Object(o.useEffect)((function(){X&&j.loadFromJSON(N,(function(){}))}),[j,X,N]),Object(o.useEffect)((function(){var t=new Y[v](j).configureCanvas({fillColor:b,strokeWidth:k,strokeColor:S,displayRadius:m,selectFillColor:y});return j.on("mouse:up",(function(t){var e=j.getObjects().indexOf(j.getActiveObject()),n=j.toJSON();3===t.button&&"select"===v&&(e=-1,j.discardActiveObject().renderAll()),P(Object(s.a)(Object(s.a)({},n),{},{selected:e})),3!==t.button&&"select"!==v||z()})),j.on("mouse:dblclick",(function(){})),function(){t(),j.off("mouse:up"),j.off("mouse:dblclick")}}),[j,k,S,m,b,v,A,P,z]),a.a.createElement("div",{style:{position:"relative"}},a.a.createElement("div",{style:{position:"absolute",top:0,left:0,zIndex:-10,visibility:"hidden"}},a.a.createElement(w,{canvasHeight:i,canvasWidth:n,shouldSendToStreamlit:d||W,stateToSendToStreamlit:N})),a.a.createElement("div",{style:{position:"absolute",top:0,left:0,zIndex:0}},a.a.createElement("canvas",{id:"backgroundimage-canvas",width:n,height:i})),a.a.createElement("div",{style:{position:"absolute",top:0,left:0,zIndex:10}},a.a.createElement("canvas",{id:"canvas",width:n,height:i,style:{border:"lightgrey 1px solid"}})),g&&a.a.createElement(C,{topPosition:i,leftPosition:n,canUndo:F,canRedo:H,downloadCallback:z,undoCallback:I,redoCallback:V,resetCallback:function(){Q(T)}}))}));n(44);r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(E,null,a.a.createElement(W,null))),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.f9a34b37.chunk.js.map