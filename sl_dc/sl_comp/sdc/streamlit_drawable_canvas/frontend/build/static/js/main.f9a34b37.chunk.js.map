{"version":3,"sources":["components/CanvasToolbar.module.css","img/undo.png","img/bin.png","img/download.png","components/CanvasToolbar.tsx","components/UpdateStreamlit.tsx","DrawableCanvasState.tsx","lib/fabrictool.ts","lib/index.ts","lib/circle.ts","lib/freedraw.ts","lib/line.ts","lib/polygon.ts","lib/rect.ts","lib/transform.ts","lib/point.ts","lib/select.ts","DrawableCanvas.tsx","index.tsx"],"names":["module","exports","SquareIcon","imgUrl","altText","invertX","size","enabled","clickCallback","src","className","styles","disabled","invertx","alt","title","height","width","onClick","defaultProps","CanvasToolbar","topPosition","canUndo","leftPosition","canRedo","downloadCallback","undoCallback","redoCallback","resetCallback","iconElements","download","undo","bin","style","position","top","left","display","gap","zIndex","map","e","key","UpdateStreamlit","props","useState","fabric","Canvas","stCanvas","setStCanvas","debouncedStateToSend","value","delay","debouncedValue","setDebouncedValue","useEffect","handler","setTimeout","clearTimeout","useDebounce","stateToSendToStreamlit","stC","enableRetinaScaling","shouldSendToStreamlit","loadFromJSON","canvas","data","getContext","toDataURL","Streamlit","setComponentValue","getWidth","getHeight","raw","toObject","sendDataToStreamlit","id","canvasWidth","canvasHeight","NO_ACTION","shouldReloadCanvas","forceSendToStreamlit","RELOAD_CANVAS","SEND_TO_STREAMLIT","RELOAD_AND_SEND_TO_STREAMLIT","canvasStateReducer","state","action","type","isEmpty","currentState","console","log","history","undoStack","redoStack","initialState","isEqual","undoOverHistoryMaxCount","length","slice","Error","isUndoEmpty","CanvasStateContext","createContext","CanvasStateProvider","children","useReducer","canvasState","dispatch","saveState","useCallback","redo","forceStreamlitUpdate","resetState","Provider","FabricTool","_canvas","this","tools","circle","isMouseDown","fillColor","strokeWidth","strokeColor","currentCircle","Circle","currentStartX","currentStartY","_minRadius","linearDistance","point1","point2","xs","x","ys","y","Math","sqrt","isDrawingMode","selection","forEachObject","o","selectable","evented","on","onMouseDown","onMouseMove","onMouseUp","onMouseOut","off","_clicked","pointer","getPointer","originX","originY","stroke","fill","radius","add","_radius","set","max","angle","atan2","PI","setCoords","renderAll","freedraw","freeDrawingBrush","color","line","currentLine","Line","points","x2","y2","remove","polygon","startCircle","currentPath","Path","_pathString","onMouseDoubleClick","_start","i","_last_pt_idx","lastIndexOf","rect","currentRect","Rect","_minLength","transparentCorners","strokeUniform","noScaleCache","abs","_width","_height","transform","args","handleDoubleClick","getActiveObject","point","displayRadius","select","lockObject","obj","lock","ops","getObjects","indexOf","setControlVisible","selectFillColor","lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","lockScalingFlip","lockSkewingX","lockSkewingY","handleSelect","deselected","aa","handleCleared","handleCreate","withStreamlitConnection","backgroundColor","backgroundImageURL","realtimeUpdateStreamlit","drawingMode","initialDrawing","displayToolbar","setCanvas","stopContextMenu","fireRightClick","StaticCanvas","backgroundCanvas","setBackgroundCanvas","useContext","Object","prototype","c","imgC","setFrameHeight","bgImage","Image","onload","drawImage","cleanupToolEvents","configureCanvas","selected","toJSON","discardActiveObject","visibility","border","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.f9a34b37.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"enabled\":\"CanvasToolbar_enabled__3TpTG\",\"disabled\":\"CanvasToolbar_disabled__3UBkF\",\"invertx\":\"CanvasToolbar_invertx__16CVq\"};","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAwwAAAMMBnc7+MwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEFSURBVEiJ7dSxLkRBFMbx31BIlkQlHoCap5BQLAXvQafV6DyLRLYSdkWv0dBQ0NAKkUhkj2bEzc3udW9xE5E9yVfNd85/5pyZSRGhzZhqtfoE8DcAKaVOqwD0mkBSSnNNAAmBAboR8V4qtoguVrNWMI9n3Gad4SQqHlRk9dHJvmns4qWwXqUrbESEspSMfazhekyhN9zhc8z6KWarAKN0jm0sI+WkmdyuPTyV/JdFSBXgATujjl3aYQf7+CjkXhTaPRYw+DbVETZLkMM6Leo3hGxhmHNfsVBnBk0hx4XcozqARpA8/GG+bQcJ6+rFTUQ81jGmlJYi4p6fa9da/IPvegL4Lb4A0uc9nRaYXwcAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAhQAAAIUB4uz/wQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHUSURBVEiJtda9ahRRFAfw3xHFJCabFEkawcYiYKMWVmohBHwFOwsfQLCxthOENHZqKxZG8DHSxcJC0Qcw7AqSNSoGci3mznp3nP0K8cBlZs7X/5z//RopJeMGlrGL1Bi7WJ4Uf9pk2cQVPMDPrJvHVra9GRc8BBARS7iKU4X6cn5+wvf8vljbIuJr4XuEdyml/YGmoGIdX/xLxayji/U2iu5iJXfwa1zbY2QOOznXE4YpuoE93D5m8lr2cLMN4BWu4TF+4HDGxIEOeng90DaW5BkVj/fyd6dhP4u5hq6Tnxdz7GZpL1eLlNIhvmEtq7Yj4mHhsoWng5Ir23b+rGO6Zc62fdAtnFewUdjOqyaylo3sMxJgqIMsvcJ5X8XrKFlCvwHQmwRQdjArwH5K6fc0AKvHAFjVoGcUwCwUdbKPHNNrOpw0RVN10MVCRCz8T4A6oI/FiIiTBKh5XFN1EDnRkETEnGrnH2sOSoC60rbqoR8R8zg3bQe102oB0DYPAwB/l/VkgJTSgeo+KDtoA6h1fSN2Me1nUV3JOj7iOT5k/csi5jNe4D2uj+og8lE7rIx4hjt4hIMRRZRyX7UYLqWUjoYsI35VLuCt6tKZ5h7ewa22XH8AgjMTispa6ucAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEYSURBVEiJ7dS9SgNBFMXxX0y0NNpLqjQiKRRETON7aBMfwLfxDcRGC8HOTm21s7RIYZdniGiRO+6y5mNXVxD0wMBw58z532Fnh1+kFq5jNH8C0MFbjE7ZTUsVAEsz5rUBvqR/wB8CNLFeY+5aZH4ArjDCXsHYNv+vbWK1UNuNrMs8oGfyFGzmjDthvA9QUe1YG4U3aQvL2M4DpqkRHfZxU4C0o9aPxhpzcsDQ5I0ZFOpHGMfas+wtSvNxePIaxNpw0QngHIcR1M3Vu3jFcXhmqsw1vZCdJCmFny3a3CoBSBAm3TbKhlcBJEj6Vo9lN1UBwENF/yfAAVaqhhS0P614J7uCdY1bsh+kh1NsfLP7pBec4KmmvNl6B0BuQt0zCQ0xAAAAAElFTkSuQmCC\"","import React from \"react\"\r\n\r\nimport styles from \"./CanvasToolbar.module.css\"\r\n\r\nimport bin from \"../img/bin.png\"\r\nimport undo from \"../img/undo.png\"\r\nimport download from \"../img/download.png\"\r\n\r\ninterface SquareIconProps {\r\n  imgUrl: string\r\n  altText: string\r\n  invertX?: boolean\r\n  size: number\r\n  enabled: boolean\r\n  clickCallback: () => void\r\n}\r\n\r\nconst SquareIcon = ({\r\n  imgUrl,\r\n  altText,\r\n  invertX,\r\n  size,\r\n  enabled,\r\n  clickCallback,\r\n}: SquareIconProps) => (\r\n  <img\r\n    src={imgUrl}\r\n    className={`\r\n    ${enabled ? styles.enabled : styles.disabled} ${\r\n      invertX ? \"\" : styles.invertx\r\n    }\r\n    `}\r\n    alt={altText}\r\n    title={altText}\r\n    height={`${size}px`}\r\n    width={`${size}px`}\r\n    onClick={clickCallback}\r\n  />\r\n)\r\nSquareIcon.defaultProps = {\r\n  invertX: false,\r\n}\r\n\r\ninterface CanvasToolbarProps {\r\n  topPosition: number\r\n  leftPosition: number\r\n  canUndo: boolean\r\n  canRedo: boolean\r\n  downloadCallback: () => void\r\n  undoCallback: () => void\r\n  redoCallback: () => void\r\n  resetCallback: () => void\r\n}\r\n\r\nconst CanvasToolbar = ({\r\n  topPosition,\r\n  leftPosition,\r\n  canUndo,\r\n  canRedo,\r\n  downloadCallback,\r\n  undoCallback,\r\n  redoCallback,\r\n  resetCallback,\r\n}: CanvasToolbarProps) => {\r\n  const GAP_BETWEEN_ICONS = 4\r\n  const ICON_SIZE = 24\r\n\r\n  const iconElements = [\r\n    {\r\n      imgUrl: download,\r\n      altText: \"Send to Streamlit\",\r\n      invertX: false,\r\n      enabled: true,\r\n      clickCallback: downloadCallback,\r\n    },\r\n    {\r\n      imgUrl: undo,\r\n      altText: \"Undo\",\r\n      invertX: true,\r\n      enabled: canUndo,\r\n      clickCallback: canUndo ? undoCallback : () => {},\r\n    },\r\n    {\r\n      imgUrl: undo,\r\n      altText: \"Redo\",\r\n      invertX: false,\r\n      enabled: canRedo,\r\n      clickCallback: canRedo ? redoCallback : () => {},\r\n    },\r\n    {\r\n      imgUrl: bin,\r\n      altText: \"Reset canvas & history\",\r\n      invertX: false,\r\n      enabled: true,\r\n      clickCallback: resetCallback,\r\n    },\r\n  ]\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        position: \"absolute\",\r\n        top: topPosition + 4,\r\n        left: 0,\r\n        display: \"flex\",\r\n        gap: GAP_BETWEEN_ICONS,\r\n        zIndex: 20,\r\n      }}\r\n    >\r\n      {iconElements.map((e) => (\r\n        <SquareIcon\r\n          key={e.altText}\r\n          imgUrl={e.imgUrl}\r\n          altText={e.altText}\r\n          invertX={e.invertX}\r\n          size={ICON_SIZE}\r\n          enabled={e.enabled}\r\n          clickCallback={e.clickCallback}\r\n        />\r\n      ))}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default CanvasToolbar\r\n","import React, { useEffect, useState } from \"react\"\r\nimport { Streamlit } from \"streamlit-component-lib\"\r\nimport { fabric } from \"fabric\"\r\n\r\nconst DELAY_DEBOUNCE = 200\r\n\r\n/**\r\n * Download image and JSON data from canvas to send back to Streamlit\r\n */\r\nconst sendDataToStreamlit = (canvas: fabric.Canvas): void => {\r\n  const data = canvas\r\n    .getContext()\r\n    .canvas.toDataURL()\r\n  Streamlit.setComponentValue({\r\n    data: data,\r\n    width: canvas.getWidth(),\r\n    height: canvas.getHeight(),\r\n    raw: canvas.toObject(['selected']), // AARON\r\n  })\r\n}\r\n\r\n/**\r\n * This hook allows you to debounce any fast changing value.\r\n * The debounced value will only reflect the latest value when the useDebounce hook has not been called for the specified time period.\r\n * When used in conjunction with useEffect, you can easily ensure that expensive operations like API calls are not executed too frequently.\r\n * https://usehooks.com/useDebounce/\r\n * @param value value to debounce\r\n * @param delay delay of debounce in ms\r\n */\r\nconst useDebounce = (value: any, delay: number) => {\r\n  const [debouncedValue, setDebouncedValue] = useState(value)\r\n\r\n  useEffect(\r\n    () => {\r\n      // Update debounced value after delay\r\n      const handler = setTimeout(() => {\r\n        setDebouncedValue(value)\r\n      }, delay)\r\n\r\n      // Cancel the timeout if value changes (also on delay change or unmount)\r\n      // This is how we prevent debounced value from updating if value is changed ...\r\n      // .. within the delay period. Timeout gets cleared and restarted.\r\n      return () => {\r\n        clearTimeout(handler)\r\n      }\r\n    },\r\n    [value, delay] // Only re-call effect if value or delay changes\r\n  )\r\n  return debouncedValue\r\n}\r\n\r\ninterface UpdateStreamlitProps {\r\n  shouldSendToStreamlit: boolean\r\n  stateToSendToStreamlit: Object\r\n  canvasWidth: number\r\n  canvasHeight: number\r\n}\r\n\r\n/**\r\n * Canvas whose sole purpose is to draw current state\r\n * to send image data to Streamlit.\r\n * Put it in the background or make it invisible!\r\n */\r\nconst UpdateStreamlit = (props: UpdateStreamlitProps) => {\r\n  const [stCanvas, setStCanvas] = useState(new fabric.Canvas(\"\"))\r\n\r\n  // Debounce fast changing canvas states\r\n  // Especially when drawing lines and circles which continuously render while drawing\r\n  const debouncedStateToSend = useDebounce(\r\n    props.stateToSendToStreamlit,\r\n    DELAY_DEBOUNCE\r\n  )\r\n\r\n  // Initialize canvas\r\n  useEffect(() => {\r\n    const stC = new fabric.Canvas(\"canvas-to-streamlit\", {\r\n      enableRetinaScaling: false,\r\n    })\r\n    setStCanvas(stC)\r\n  }, [])\r\n\r\n  // Load state to canvas, then send content to Streamlit\r\n  useEffect(() => {\r\n    if (debouncedStateToSend && props.shouldSendToStreamlit) {\r\n      // console.log('AARON - debouncedStateToSend', debouncedStateToSend)\r\n      stCanvas.loadFromJSON(debouncedStateToSend, () => {\r\n        // console.log('AARON - stCanvas', stCanvas)\r\n        sendDataToStreamlit(stCanvas)\r\n      })\r\n    }\r\n  }, [stCanvas, props.shouldSendToStreamlit, debouncedStateToSend])\r\n\r\n  return (\r\n    <canvas\r\n      id=\"canvas-to-streamlit\"\r\n      width={props.canvasWidth}\r\n      height={props.canvasHeight}\r\n    />\r\n  )\r\n}\r\n\r\nexport default UpdateStreamlit\r\n","import React, {\r\n  createContext,\r\n  useReducer,\r\n  useContext,\r\n  useCallback,\r\n} from \"react\"\r\nimport { isEmpty, isEqual } from \"lodash\"\r\n\r\nconst HISTORY_MAX_COUNT = 100\r\n\r\ninterface CanvasHistory {\r\n  undoStack: Object[] // store previous canvas states\r\n  redoStack: Object[] // store undone canvas states\r\n}\r\n\r\ninterface CanvasAction {\r\n  shouldReloadCanvas: boolean // reload currentState into app canvas, on undo/redo\r\n  forceSendToStreamlit: boolean // send currentState back to Streamlit\r\n}\r\n\r\nconst NO_ACTION: CanvasAction = {\r\n  shouldReloadCanvas: false,\r\n  forceSendToStreamlit: false,\r\n}\r\n\r\nconst RELOAD_CANVAS: CanvasAction = {\r\n  shouldReloadCanvas: true,\r\n  forceSendToStreamlit: false,\r\n}\r\n\r\nconst SEND_TO_STREAMLIT: CanvasAction = {\r\n  shouldReloadCanvas: false,\r\n  forceSendToStreamlit: true,\r\n}\r\n\r\nconst RELOAD_AND_SEND_TO_STREAMLIT: CanvasAction = {\r\n  shouldReloadCanvas: true,\r\n  forceSendToStreamlit: true,\r\n}\r\n\r\ninterface CanvasState {\r\n  history: CanvasHistory\r\n  action: CanvasAction\r\n  initialState: Object // first currentState for app\r\n  currentState: Object // current canvas state as canvas.toJSON()\r\n}\r\n\r\ninterface Action {\r\n  type: \"save\" | \"undo\" | \"redo\" | \"reset\" | \"forceSendToStreamlit\"\r\n  state?: Object\r\n}\r\n\r\n/**\r\n * Reducer takes 5 actions: save, undo, redo, reset, forceSendToStreamlit\r\n *\r\n * On reset, clear everything, set initial and current state to cleared canvas\r\n *\r\n * On save:\r\n * - First, if there is no initial state, set it to current\r\n *   Since we don't reset history on component initialization\r\n *   As backgroundColor/image are applied after component init\r\n *   and wouldn't be stored in initial state\r\n * - If the sent state is same as current state, then nothing has changed so don't save\r\n * - Clear redo stack\r\n * - Push current state to undo stack, delete oldest if necessary\r\n * - Set new current state\r\n *\r\n * On undo:\r\n * - Push state to redoStack if it's not the initial\r\n * - Pop state from undoStack into current state\r\n *\r\n * On redo:\r\n * - Pop state from redoStack into current state\r\n *\r\n * For undo/redo/reset, set shouldReloadCanvas to inject currentState into user facing canvas\r\n */\r\nconst canvasStateReducer = (\r\n  state: CanvasState,\r\n  action: Action\r\n): CanvasState => {\r\n  switch (action.type) {\r\n    case \"save\":\r\n      // console.log('AARON state checks', action.state, state.initialState, state.currentState) // is data getting saved?\r\n      if (!action.state) throw new Error(\"No action state to save\")\r\n      else if (isEmpty(state.currentState)) {\r\n        console.log('AARON - empty currentState')\r\n        return {\r\n          history: {\r\n            undoStack: [],\r\n            redoStack: [],\r\n          },\r\n          action: { ...NO_ACTION },\r\n          initialState: action.state,\r\n          currentState: action.state,\r\n        }\r\n      } else if (isEqual(action.state, state.currentState))\r\n        return {\r\n          history: { ...state.history },\r\n          action: { ...NO_ACTION },\r\n          initialState: state.initialState,\r\n          currentState: state.currentState,\r\n        }\r\n      else {\r\n        // console.log('AARON - some changes in state')\r\n        const undoOverHistoryMaxCount =\r\n          state.history.undoStack.length >= HISTORY_MAX_COUNT\r\n        return {\r\n          history: {\r\n            undoStack: [\r\n              ...state.history.undoStack.slice(undoOverHistoryMaxCount ? 1 : 0),\r\n              state.currentState,\r\n            ],\r\n            redoStack: [],\r\n          },\r\n          action: { ...NO_ACTION },\r\n          initialState:\r\n            state.initialState == null\r\n              ? state.currentState\r\n              : state.initialState,\r\n          currentState: action.state,\r\n        }\r\n      }\r\n    case \"undo\":\r\n      if (\r\n        isEmpty(state.currentState) ||\r\n        isEqual(state.initialState, state.currentState)\r\n      ) {\r\n        return {\r\n          history: { ...state.history },\r\n          action: { ...NO_ACTION },\r\n          initialState: state.initialState,\r\n          currentState: state.currentState,\r\n        }\r\n      } else {\r\n        const isUndoEmpty = state.history.undoStack.length === 0\r\n        return {\r\n          history: {\r\n            undoStack: state.history.undoStack.slice(0, -1),\r\n            redoStack: [...state.history.redoStack, state.currentState],\r\n          },\r\n          action: { ...RELOAD_CANVAS },\r\n          initialState: state.initialState,\r\n          currentState: isUndoEmpty\r\n            ? state.currentState\r\n            : state.history.undoStack[state.history.undoStack.length - 1],\r\n        }\r\n      }\r\n    case \"redo\":\r\n      if (state.history.redoStack.length > 0) {\r\n        // TODO: test currentState empty too ?\r\n        return {\r\n          history: {\r\n            undoStack: [...state.history.undoStack, state.currentState],\r\n            redoStack: state.history.redoStack.slice(0, -1),\r\n          },\r\n          action: { ...RELOAD_CANVAS },\r\n          initialState: state.initialState,\r\n          currentState:\r\n            state.history.redoStack[state.history.redoStack.length - 1],\r\n        }\r\n      } else {\r\n        return {\r\n          history: { ...state.history },\r\n          action: { ...NO_ACTION },\r\n          initialState: state.initialState,\r\n          currentState: state.currentState,\r\n        }\r\n      }\r\n    case \"reset\":\r\n      if (!action.state) throw new Error(\"No action state to store in reset\")\r\n      return {\r\n        history: {\r\n          undoStack: [],\r\n          redoStack: [],\r\n        },\r\n        action: { ...RELOAD_AND_SEND_TO_STREAMLIT },\r\n        initialState: action.state,\r\n        currentState: action.state,\r\n      }\r\n    case \"forceSendToStreamlit\":\r\n      return {\r\n        history: { ...state.history },\r\n        action: { ...SEND_TO_STREAMLIT },\r\n        initialState: state.initialState,\r\n        currentState: state.currentState,\r\n      }\r\n    default:\r\n      throw new Error(\"TS should protect from this\")\r\n  }\r\n}\r\n\r\nconst initialState: CanvasState = {\r\n  history: {\r\n    undoStack: [],\r\n    redoStack: [],\r\n  },\r\n  action: {\r\n    forceSendToStreamlit: false,\r\n    shouldReloadCanvas: false,\r\n  },\r\n  initialState: {},\r\n  currentState: {},\r\n}\r\n\r\ninterface CanvasStateContextProps {\r\n  canvasState: CanvasState\r\n  saveState: (state: Object) => void\r\n  undo: () => void\r\n  redo: () => void\r\n  forceStreamlitUpdate: () => void\r\n  canUndo: boolean\r\n  canRedo: boolean\r\n  resetState: (state: Object) => void\r\n}\r\n\r\nconst CanvasStateContext = createContext<CanvasStateContextProps>(\r\n  {} as CanvasStateContextProps\r\n)\r\n\r\nexport const CanvasStateProvider = ({\r\n  children,\r\n}: React.PropsWithChildren<{}>) => {\r\n  const [canvasState, dispatch] = useReducer(canvasStateReducer, initialState)\r\n\r\n  // Setup our callback functions\r\n  // We memoize with useCallback to prevent unnecessary re-renders\r\n  const saveState = useCallback(\r\n    (state) => dispatch({ type: \"save\", state: state }),\r\n    [dispatch]\r\n  )\r\n  const undo = useCallback(() => dispatch({ type: \"undo\" }), [dispatch])\r\n  const redo = useCallback(() => dispatch({ type: \"redo\" }), [dispatch])\r\n  const forceStreamlitUpdate = useCallback(\r\n    () => dispatch({ type: \"forceSendToStreamlit\" }),\r\n    [dispatch]\r\n  )\r\n  const resetState = useCallback(\r\n    (state) => dispatch({ type: \"reset\", state: state }),\r\n    [dispatch]\r\n  )\r\n\r\n  const canUndo = canvasState.history.undoStack.length !== 0\r\n  const canRedo = canvasState.history.redoStack.length !== 0\r\n\r\n  return (\r\n    <CanvasStateContext.Provider\r\n      value={{\r\n        canvasState,\r\n        saveState,\r\n        undo,\r\n        redo,\r\n        canUndo,\r\n        canRedo,\r\n        forceStreamlitUpdate,\r\n        resetState,\r\n      }}\r\n    >\r\n      {children}\r\n    </CanvasStateContext.Provider>\r\n  )\r\n}\r\n\r\n/**\r\n * Hook to get data out of context\r\n */\r\nexport const useCanvasState = () => {\r\n  return useContext(CanvasStateContext)\r\n}\r\n","import { fabric } from \"fabric\"\r\n\r\nexport interface ConfigureCanvasProps {\r\n    fillColor: string\r\n    strokeWidth: number\r\n    strokeColor: string\r\n    displayRadius: number\r\n\r\n    selectFillColor: string // AARON\r\n}\r\n\r\n/**\r\n * Base class for any fabric tool that configures and draws on canvas\r\n */\r\nabstract class FabricTool {\r\n  protected _canvas: fabric.Canvas\r\n\r\n  /**\r\n   * Pass Fabric canvas by reference so tools can configure it\r\n   */\r\n  constructor(canvas: fabric.Canvas) {\r\n    this._canvas = canvas\r\n  }\r\n\r\n  /**\r\n   * Configure canvas and return a callback to clean eventListeners\r\n   * @param args\r\n   */\r\n  abstract configureCanvas(args: ConfigureCanvasProps): () => void\r\n}\r\n\r\nexport default FabricTool\r\n","import CircleTool from \"./circle\"\r\nimport FabricTool from \"./fabrictool\"\r\nimport FreedrawTool from \"./freedraw\"\r\nimport LineTool from \"./line\"\r\nimport PolygonTool from \"./polygon\"\r\nimport RectTool from \"./rect\"\r\nimport TransformTool from \"./transform\"\r\nimport PointTool from \"./point\"\r\nimport SelectTool from \"./select\" // AARON\r\n\r\n// TODO: Should make TS happy on the Map of selectedTool --> FabricTool\r\nconst tools: any = {\r\n  circle: CircleTool,\r\n  freedraw: FreedrawTool,\r\n  line: LineTool,\r\n  polygon: PolygonTool,\r\n  rect: RectTool,\r\n  transform: TransformTool,\r\n  point: PointTool,\r\n  select: SelectTool // AARON\r\n}\r\n\r\nexport { tools, FabricTool }\r\n","import { fabric } from \"fabric\"\r\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\r\n\r\nclass CircleTool extends FabricTool {\r\n  isMouseDown: boolean = false\r\n  fillColor: string = \"#ffffff\"\r\n  strokeWidth: number = 10\r\n  strokeColor: string = \"#ffffff\"\r\n  currentCircle: fabric.Circle = new fabric.Circle()\r\n  currentStartX: number = 0\r\n  currentStartY: number = 0\r\n  _minRadius: number = 10\r\n\r\n  configureCanvas({\r\n    strokeWidth,\r\n    strokeColor,\r\n    fillColor,\r\n  }: ConfigureCanvasProps): () => void {\r\n    this._canvas.isDrawingMode = false\r\n    this._canvas.selection = false\r\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\r\n\r\n    this.strokeWidth = strokeWidth\r\n    this.strokeColor = strokeColor\r\n    this.fillColor = fillColor\r\n    this._minRadius = strokeWidth\r\n\r\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\r\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\r\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\r\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\r\n    return () => {\r\n      this._canvas.off(\"mouse:down\")\r\n      this._canvas.off(\"mouse:move\")\r\n      this._canvas.off(\"mouse:up\")\r\n      this._canvas.off(\"mouse:out\")\r\n    }\r\n  }\r\n\r\n  onMouseDown(o: any) {\r\n    let canvas = this._canvas\r\n    let _clicked = o.e[\"button\"]\r\n    this.isMouseDown = true\r\n    let pointer = canvas.getPointer(o.e)\r\n    this.currentStartX = pointer.x\r\n    this.currentStartY = pointer.y\r\n    this.currentCircle = new fabric.Circle({\r\n      left: this.currentStartX,\r\n      top: this.currentStartY,\r\n      originX: \"left\",\r\n      originY: \"center\",\r\n      strokeWidth: this.strokeWidth,\r\n      stroke: this.strokeColor,\r\n      fill: this.fillColor,\r\n      selectable: false,\r\n      evented: false,\r\n      radius: this._minRadius,\r\n    })\r\n    if (_clicked === 0) {\r\n      canvas.add(this.currentCircle)\r\n    }\r\n  }\r\n\r\n  onMouseMove(o: any) {\r\n    if (!this.isMouseDown) return\r\n    let canvas = this._canvas\r\n    let pointer = canvas.getPointer(o.e)\r\n    let _radius =\r\n      this.linearDistance(\r\n        { x: this.currentStartX, y: this.currentStartY },\r\n        { x: pointer.x, y: pointer.y }\r\n      ) / 2\r\n    this.currentCircle.set({\r\n      radius: Math.max(_radius, this._minRadius),\r\n      angle:\r\n        (Math.atan2(\r\n          pointer.y - this.currentStartY,\r\n          pointer.x - this.currentStartX\r\n        ) *\r\n          180) /\r\n        Math.PI,\r\n    })\r\n    this.currentCircle.setCoords()\r\n    canvas.renderAll()\r\n  }\r\n\r\n  onMouseUp(o: any) {\r\n    this.isMouseDown = false\r\n  }\r\n\r\n  onMouseOut(o: any) {\r\n    this.isMouseDown = false\r\n  }\r\n\r\n  /**\r\n   * Calculate the distance of two x,y points\r\n   *\r\n   * @param point1 an object with x,y attributes representing the start point\r\n   * @param point2 an object with x,y attributes representing the end point\r\n   *\r\n   * @returns {number}\r\n   */\r\n  linearDistance = (point1: any, point2: any) => {\r\n    let xs = point2.x - point1.x\r\n    let ys = point2.y - point1.y\r\n    return Math.sqrt(xs * xs + ys * ys)\r\n  }\r\n}\r\n\r\nexport default CircleTool\r\n","import FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\r\n\r\nclass FreedrawTool extends FabricTool {\r\n  configureCanvas({\r\n    strokeWidth,\r\n    strokeColor,\r\n  }: ConfigureCanvasProps): () => void {\r\n    this._canvas.isDrawingMode = true\r\n    this._canvas.freeDrawingBrush.width = strokeWidth\r\n    this._canvas.freeDrawingBrush.color = strokeColor\r\n    return () => {}\r\n  }\r\n}\r\n\r\nexport default FreedrawTool\r\n","import { fabric } from \"fabric\"\r\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\r\n\r\nclass LineTool extends FabricTool {\r\n  isMouseDown: boolean = false\r\n  strokeWidth: number = 10\r\n  strokeColor: string = \"#ffffff\"\r\n  currentLine: fabric.Line = new fabric.Line()\r\n\r\n  configureCanvas({\r\n    strokeWidth,\r\n    strokeColor,\r\n  }: ConfigureCanvasProps): () => void {\r\n    this._canvas.isDrawingMode = false\r\n    this._canvas.selection = false\r\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\r\n\r\n    this.strokeWidth = strokeWidth\r\n    this.strokeColor = strokeColor\r\n\r\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\r\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\r\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\r\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\r\n    return () => {\r\n      this._canvas.off(\"mouse:down\")\r\n      this._canvas.off(\"mouse:move\")\r\n      this._canvas.off(\"mouse:up\")\r\n      this._canvas.off(\"mouse:out\")\r\n    }\r\n  }\r\n\r\n  onMouseDown(o: any) {\r\n    let canvas = this._canvas\r\n    let _clicked = o.e[\"button\"]\r\n    this.isMouseDown = true\r\n    var pointer = canvas.getPointer(o.e)\r\n    var points = [pointer.x, pointer.y, pointer.x, pointer.y]\r\n    this.currentLine = new fabric.Line(points, {\r\n      strokeWidth: this.strokeWidth,\r\n      fill: this.strokeColor,\r\n      stroke: this.strokeColor,\r\n      originX: \"center\",\r\n      originY: \"center\",\r\n      selectable: false,\r\n      evented: false,\r\n    })\r\n    if (_clicked === 0) {\r\n      canvas.add(this.currentLine)\r\n    }\r\n  }\r\n\r\n  onMouseMove(o: any) {\r\n    if (!this.isMouseDown) return\r\n    let canvas = this._canvas\r\n    var pointer = canvas.getPointer(o.e)\r\n    this.currentLine.set({ x2: pointer.x, y2: pointer.y })\r\n    this.currentLine.setCoords()\r\n    canvas.renderAll()\r\n  }\r\n\r\n  onMouseUp(o: any) {\r\n    this.isMouseDown = false\r\n    let canvas = this._canvas\r\n    if (this.currentLine.width === 0 && this.currentLine.height === 0) {\r\n      canvas.remove(this.currentLine)\r\n    }\r\n  }\r\n\r\n  onMouseOut(o: any) {\r\n    this.isMouseDown = false\r\n  }\r\n}\r\n\r\nexport default LineTool\r\n","import { fabric } from \"fabric\"\r\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\r\n\r\nclass PolygonTool extends FabricTool {\r\n  isMouseDown: boolean = false\r\n  fillColor: string = \"#ffffff\"\r\n  strokeWidth: number = 10\r\n  strokeColor: string = \"#ffffff\"\r\n  startCircle: fabric.Circle = new fabric.Circle()\r\n  currentLine: fabric.Line = new fabric.Line()\r\n  currentPath: fabric.Path = new fabric.Path()\r\n  _pathString: string = \"M \"\r\n\r\n  configureCanvas({\r\n    strokeWidth,\r\n    strokeColor,\r\n    fillColor,\r\n  }: ConfigureCanvasProps): () => void {\r\n    this._canvas.isDrawingMode = false\r\n    this._canvas.selection = false\r\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\r\n\r\n    this.strokeWidth = strokeWidth\r\n    this.strokeColor = strokeColor\r\n    this.fillColor = fillColor\r\n\r\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\r\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\r\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\r\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\r\n    this._canvas.on(\"mouse:dblclick\", (e: any) => this.onMouseDoubleClick(e))\r\n    return () => {\r\n      this._canvas.off(\"mouse:down\")\r\n      this._canvas.off(\"mouse:move\")\r\n      this._canvas.off(\"mouse:up\")\r\n      this._canvas.off(\"mouse:out\")\r\n      this._canvas.off(\"mouse:dblclick\")\r\n    }\r\n  }\r\n\r\n  onMouseDown(o: any) {\r\n    let canvas = this._canvas\r\n    let _clicked = o.e[\"button\"]\r\n    let _start = false\r\n    if (this._pathString === \"M \") {\r\n      _start = true\r\n    }\r\n\r\n    this.isMouseDown = true\r\n    var pointer = canvas.getPointer(o.e)\r\n\r\n    var points = [pointer.x, pointer.y, pointer.x, pointer.y]\r\n    canvas.remove(this.currentLine)\r\n    this.currentLine = new fabric.Line(points, {\r\n      strokeWidth: this.strokeWidth,\r\n      fill: this.strokeColor,\r\n      stroke: this.strokeColor,\r\n      originX: \"center\",\r\n      originY: \"center\",\r\n      selectable: false,\r\n      evented: false,\r\n    })\r\n    if (_clicked === 0) {\r\n      canvas.add(this.currentLine)\r\n    }\r\n\r\n    if (_start && _clicked === 0) {\r\n      // Initialize pathString\r\n      this._pathString += `${pointer.x} ${pointer.y} `\r\n      this.startCircle = new fabric.Circle({\r\n        left: pointer.x,\r\n        top: pointer.y,\r\n        originX: \"center\",\r\n        originY: \"center\",\r\n        strokeWidth: this.strokeWidth,\r\n        stroke: this.strokeColor,\r\n        fill: this.strokeColor,\r\n        selectable: false,\r\n        evented: false,\r\n        radius: this.strokeWidth,\r\n      })\r\n      canvas.add(this.startCircle)\r\n\r\n      _start = false\r\n    } else {\r\n      canvas.remove(this.currentPath)\r\n      if (_clicked === 0) {\r\n        // Update pathString\r\n        this._pathString += `L ${pointer.x} ${pointer.y} `\r\n      }\r\n      if (_clicked === 2) {\r\n        // Close pathString\r\n        this._pathString += \"z\"\r\n        canvas.remove(this.startCircle)\r\n      }\r\n    }\r\n    this.currentPath = new fabric.Path(this._pathString, {\r\n      strokeWidth: this.strokeWidth,\r\n      fill: this.fillColor,\r\n      stroke: this.strokeColor,\r\n      originX: \"center\",\r\n      originY: \"center\",\r\n      selectable: false,\r\n      evented: false,\r\n    })\r\n    if (this.currentPath.width !== 0 && this.currentPath.height !== 0) {\r\n      canvas.add(this.currentPath)\r\n    }\r\n    if (_clicked === 2) {\r\n      this._pathString = \"M \"\r\n    }\r\n  }\r\n\r\n  onMouseMove(o: any) {\r\n    if (!this.isMouseDown) return\r\n    let canvas = this._canvas\r\n    var pointer = canvas.getPointer(o.e)\r\n    this.currentLine.set({ x2: pointer.x, y2: pointer.y })\r\n    this.currentLine.setCoords()\r\n    canvas.renderAll()\r\n  }\r\n\r\n  onMouseUp(o: any) {\r\n    this.isMouseDown = true\r\n  }\r\n\r\n  onMouseOut(o: any) {\r\n    this.isMouseDown = false\r\n  }\r\n\r\n  onMouseDoubleClick(o: any) {\r\n    let canvas = this._canvas\r\n    // Double click adds two more points at the end, so we have to move back twice more...\r\n    for (let i = 0; i < 3; i++) {\r\n      let _last_pt_idx = this._pathString.lastIndexOf(\"L\")\r\n      if (_last_pt_idx === -1) {\r\n        this._pathString = \"M \"\r\n        canvas.remove(this.startCircle)\r\n      } else {\r\n        this._pathString = this._pathString.slice(0, _last_pt_idx)\r\n      }\r\n    }\r\n\r\n    canvas.remove(this.currentLine)\r\n    canvas.remove(this.currentPath)\r\n    this.currentPath = new fabric.Path(this._pathString, {\r\n      strokeWidth: this.strokeWidth,\r\n      fill: this.fillColor,\r\n      stroke: this.strokeColor,\r\n      originX: \"center\",\r\n      originY: \"center\",\r\n      selectable: false,\r\n      evented: false,\r\n    })\r\n    canvas.add(this.currentPath)\r\n  }\r\n}\r\nexport default PolygonTool\r\n","import { fabric } from \"fabric\"\r\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\r\n\r\nclass RectTool extends FabricTool {\r\n  isMouseDown: boolean = false\r\n  fillColor: string = \"#ffffff\"\r\n  strokeWidth: number = 10\r\n  strokeColor: string = \"#ffffff\"\r\n  currentRect: fabric.Rect = new fabric.Rect()\r\n  currentStartX: number = 0\r\n  currentStartY: number = 0\r\n  _minLength: number = 10\r\n\r\n  configureCanvas({\r\n    strokeWidth,\r\n    strokeColor,\r\n    fillColor,\r\n  }: ConfigureCanvasProps): () => void {\r\n    this._canvas.isDrawingMode = false\r\n    this._canvas.selection = false\r\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\r\n\r\n    this.strokeWidth = strokeWidth\r\n    this.strokeColor = strokeColor\r\n    this.fillColor = fillColor\r\n    this._minLength = strokeWidth\r\n\r\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\r\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\r\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\r\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\r\n    return () => {\r\n      this._canvas.off(\"mouse:down\")\r\n      this._canvas.off(\"mouse:move\")\r\n      this._canvas.off(\"mouse:up\")\r\n      this._canvas.off(\"mouse:out\")\r\n    }\r\n  }\r\n\r\n  onMouseDown(o: any) {\r\n    let canvas = this._canvas\r\n    let _clicked = o.e[\"button\"]\r\n    this.isMouseDown = true\r\n    let pointer = canvas.getPointer(o.e)\r\n    this.currentStartX = pointer.x\r\n    this.currentStartY = pointer.y\r\n    this.currentRect = new fabric.Rect({\r\n      left: this.currentStartX,\r\n      top: this.currentStartY,\r\n      originX: \"left\",\r\n      originY: \"top\",\r\n      width: this._minLength,\r\n      height: this._minLength,\r\n      stroke: this.strokeColor,\r\n      strokeWidth: this.strokeWidth,\r\n      fill: this.fillColor,\r\n      transparentCorners: false,\r\n      selectable: false,\r\n      evented: false,\r\n      strokeUniform: true,\r\n      noScaleCache: false,\r\n      angle: 0,\r\n    })\r\n    if (_clicked === 0) {\r\n      canvas.add(this.currentRect)\r\n    }\r\n  }\r\n\r\n  onMouseMove(o: any) {\r\n    if (!this.isMouseDown) return\r\n    let canvas = this._canvas\r\n    let pointer = canvas.getPointer(o.e)\r\n    if (this.currentStartX > pointer.x) {\r\n      this.currentRect.set({ left: Math.abs(pointer.x) })\r\n    }\r\n    if (this.currentStartY > pointer.y) {\r\n      this.currentRect.set({ top: Math.abs(pointer.y) })\r\n    }\r\n    let _width = Math.abs(this.currentStartX - pointer.x)\r\n    let _height = Math.abs(this.currentStartY - pointer.y)\r\n    this.currentRect.set({\r\n      width: Math.max(_width, this._minLength * 2),\r\n      height: Math.max(_height, this._minLength * 2),\r\n    })\r\n    this.currentRect.setCoords()\r\n    canvas.renderAll()\r\n  }\r\n\r\n  onMouseUp(o: any) {\r\n    this.isMouseDown = false\r\n  }\r\n\r\n  onMouseOut(o: any) {\r\n    this.isMouseDown = false\r\n  }\r\n}\r\n\r\nexport default RectTool\r\n","import FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\r\n\r\nclass TransformTool extends FabricTool {\r\n  configureCanvas(args: ConfigureCanvasProps): () => void {\r\n    let canvas = this._canvas\r\n    canvas.isDrawingMode = false\r\n    canvas.selection = true\r\n    canvas.forEachObject((o) => (o.selectable = o.evented = true))\r\n\r\n    // instead of looking for target of double click,\r\n    // assume double click on object clears the selected object\r\n    const handleDoubleClick = () => {\r\n      canvas.remove(canvas.getActiveObject())\r\n    }\r\n\r\n    canvas.on(\"mouse:dblclick\", handleDoubleClick)\r\n    return () => {\r\n      canvas.off(\"mouse:dblclick\", handleDoubleClick)\r\n    }\r\n  }\r\n}\r\n\r\nexport default TransformTool\r\n","import { fabric } from \"fabric\"\r\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\r\n\r\nclass PointTool extends FabricTool {\r\n  isMouseDown: boolean = false\r\n  fillColor: string = \"#ffffff\"\r\n  strokeWidth: number = 10\r\n  strokeColor: string = \"#ffffff\"\r\n  currentCircle: fabric.Circle = new fabric.Circle()\r\n  currentStartX: number = 0\r\n  currentStartY: number = 0\r\n  displayRadius: number = 1\r\n\r\n  configureCanvas({\r\n    strokeWidth,\r\n    strokeColor,\r\n    fillColor,\r\n    displayRadius\r\n  }: ConfigureCanvasProps): () => void {\r\n    this._canvas.isDrawingMode = false\r\n    this._canvas.selection = false\r\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\r\n\r\n    this.strokeWidth = strokeWidth\r\n    this.strokeColor = strokeColor\r\n    this.fillColor = fillColor\r\n    this.displayRadius = displayRadius\r\n\r\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\r\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\r\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\r\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\r\n    return () => {\r\n      this._canvas.off(\"mouse:down\")\r\n      this._canvas.off(\"mouse:move\")\r\n      this._canvas.off(\"mouse:up\")\r\n      this._canvas.off(\"mouse:out\")\r\n    }\r\n  }\r\n\r\n  onMouseDown(o: any) {\r\n    let canvas = this._canvas\r\n    let _clicked = o.e[\"button\"]\r\n    this.isMouseDown = true\r\n    let pointer = canvas.getPointer(o.e)\r\n    this.currentStartX = pointer.x - (this.displayRadius + this.strokeWidth / 2.)\r\n    this.currentStartY = pointer.y //- (this._minRadius + this.strokeWidth)\r\n    this.currentCircle = new fabric.Circle({\r\n      left: this.currentStartX,\r\n      top: this.currentStartY,\r\n      originX: \"left\",\r\n      originY: \"center\",\r\n      strokeWidth: this.strokeWidth,\r\n      stroke: this.strokeColor,\r\n      fill: this.fillColor,\r\n      selectable: false,\r\n      evented: false,\r\n      radius: this.displayRadius,\r\n    })\r\n    if (_clicked === 0) {\r\n      canvas.add(this.currentCircle)\r\n    }\r\n  }\r\n\r\n  onMouseMove(o: any) {\r\n    if (!this.isMouseDown) return\r\n    let canvas = this._canvas\r\n    this.currentCircle.setCoords()\r\n    canvas.renderAll()\r\n  }\r\n\r\n  onMouseUp(o: any) {\r\n    this.isMouseDown = false\r\n  }\r\n\r\n  onMouseOut(o: any) {\r\n    this.isMouseDown = false\r\n  }\r\n\r\n}\r\n\r\nexport default PointTool\r\n","import FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\r\n\r\nclass SelectTool extends FabricTool {\r\n  configureCanvas(args: ConfigureCanvasProps): () => void {\r\n    let canvas = this._canvas\r\n    canvas.isDrawingMode = false\r\n    canvas.selection = true\r\n    canvas.forEachObject((o) => (o.selectable = o.evented = true))\r\n\r\n    const lockObject = (obj: fabric.Object, lock: boolean, ops: String) => {\r\n      if (!obj) return obj\r\n      console.log(ops, obj)\r\n\r\n      const index = canvas.getObjects().indexOf(obj)\r\n      // console.log('obj index', index)\r\n\r\n      if (lock) {\r\n        obj.setControlVisible('mtr', false) // remove rotating point\r\n        obj.set('fill', args.selectFillColor)\r\n      } else {\r\n        obj.setControlVisible('mtr', true) // put back rotating point\r\n        obj.set('fill', 'rgba(255, 255, 255, 0.1)')\r\n      }\r\n      // obj.cornerSize = 0\r\n      // obj.hasBorders = false\r\n      // obj.borderColor = args.borderColor || '#ffff00'\r\n      // obj.selectionBackgroundColor = args.selectionBackgroundColor || 'rgba(255, 0, 0, 0.3)'\r\n\r\n      obj.lockMovementX = lock\r\n      obj.lockMovementY = lock\r\n      obj.lockRotation = lock\r\n      obj.lockScalingX = lock\r\n      obj.lockScalingY = lock\r\n      obj.lockScalingFlip = lock\r\n      obj.lockSkewingX = lock\r\n      obj.lockSkewingY = lock\r\n      return obj\r\n    }\r\n    \r\n    const handleSelect = (e: any) => {\r\n      console.log('e', e)\r\n      if (e.deselected.length) {\r\n        e.deselected[0].set('fill', 'rgba(255, 255, 255, 0.0)')\r\n      }\r\n      const aa : any = canvas.getActiveObject()\r\n      lockObject(aa, true, 'SINGLE SELECT')\r\n    }\r\n\r\n    const handleCleared = (e: any) => {\r\n      const aa : any = canvas.getActiveObject()\r\n      lockObject(aa, false, 'CLEARED')\r\n    }\r\n\r\n    const handleCreate = (e: any) => {\r\n      const aa : any = canvas.getActiveObject()\r\n      lockObject(aa, true, 'CREATED')\r\n    }\r\n\r\n    canvas.on(\"selection:created\", handleCreate)\r\n    canvas.on(\"selection:updated\", handleSelect)\r\n    canvas.on(\"before:selection:cleared\", handleCleared)\r\n    return () => {\r\n      canvas.off(\"selection:created\", handleCreate)\r\n      canvas.off(\"selection:updated\", handleSelect)\r\n      canvas.off(\"before:selection:cleared\", handleCleared)\r\n    }\r\n  }\r\n}\r\n\r\nexport default SelectTool\r\n","import React, { useEffect, useState } from \"react\"\r\nimport {\r\n  ComponentProps,\r\n  Streamlit,\r\n  withStreamlitConnection,\r\n} from \"streamlit-component-lib\"\r\nimport { fabric } from \"fabric\"\r\nimport { isEqual } from \"lodash\"\r\n\r\nimport CanvasToolbar from \"./components/CanvasToolbar\"\r\nimport UpdateStreamlit from \"./components/UpdateStreamlit\"\r\n\r\nimport { useCanvasState } from \"./DrawableCanvasState\"\r\nimport { tools, FabricTool } from \"./lib\"\r\nimport { convertTypeAcquisitionFromJson } from \"typescript\"\r\n\r\n/**\r\n * Arguments Streamlit receives from the Python side\r\n */\r\nexport interface PythonArgs {\r\n  fillColor: string\r\n  strokeWidth: number\r\n  strokeColor: string\r\n  backgroundColor: string\r\n  backgroundImageURL: string\r\n  realtimeUpdateStreamlit: boolean\r\n  canvasWidth: number\r\n  canvasHeight: number\r\n  drawingMode: string\r\n  initialDrawing: Object\r\n  displayToolbar: boolean\r\n  displayRadius: number\r\n\r\n  selectFillColor: string // AARON\r\n}\r\n\r\n/**\r\n * Define logic for the canvas area\r\n */\r\nconst DrawableCanvas = ({ args }: ComponentProps) => {\r\n  const {\r\n    canvasWidth,\r\n    canvasHeight,\r\n    backgroundColor,\r\n    backgroundImageURL,\r\n    realtimeUpdateStreamlit,\r\n    drawingMode,\r\n    fillColor,\r\n    strokeWidth,\r\n    strokeColor,\r\n    displayRadius,\r\n    initialDrawing,\r\n    displayToolbar,\r\n\r\n    selectFillColor, // AARON\r\n  }: PythonArgs = args\r\n\r\n  /**\r\n   * State initialization\r\n   */\r\n  const [canvas, setCanvas] = useState(new fabric.Canvas(\"\"))\r\n  canvas.stopContextMenu = true\r\n  canvas.fireRightClick = true\r\n\r\n  const [backgroundCanvas, setBackgroundCanvas] = useState(\r\n    new fabric.StaticCanvas(\"\")\r\n  )\r\n  const {\r\n    canvasState: {\r\n      action: { shouldReloadCanvas, forceSendToStreamlit },\r\n      currentState,\r\n      initialState,\r\n    },\r\n    saveState,\r\n    undo,\r\n    redo,\r\n    canUndo,\r\n    canRedo,\r\n    forceStreamlitUpdate,\r\n    resetState,\r\n  } = useCanvasState()\r\n\r\n  /**\r\n   * Initialize canvases on component mount\r\n   * NB: Remount component by changing its key instead of defining deps\r\n   */\r\n  useEffect(() => {\r\n    fabric.Object.prototype.set({\r\n      //   transparentCorners: false,\r\n    })\r\n    const c = new fabric.Canvas(\"canvas\", {\r\n      enableRetinaScaling: false,\r\n    })\r\n    const imgC = new fabric.StaticCanvas(\"backgroundimage-canvas\", {\r\n      enableRetinaScaling: false,\r\n    })\r\n    setCanvas(c)\r\n    setBackgroundCanvas(imgC)\r\n    Streamlit.setFrameHeight()\r\n  }, [])\r\n\r\n  /**\r\n   * Load user drawing into canvas\r\n   * Python-side is in charge of initializing drawing with background color if none provided\r\n   */\r\n  useEffect(() => {\r\n    if (!isEqual(initialState, initialDrawing)) {\r\n      canvas.loadFromJSON(initialDrawing, () => {\r\n        canvas.renderAll()\r\n        resetState(initialDrawing)\r\n      })\r\n    }\r\n  }, [canvas, initialDrawing, initialState, resetState])\r\n\r\n  /**\r\n   * Update background image\r\n   */\r\n  useEffect(() => {\r\n    if (backgroundImageURL) {\r\n      var bgImage = new Image();\r\n      bgImage.onload = function() {\r\n        backgroundCanvas.getContext().drawImage(bgImage, 0, 0);\r\n      };\r\n      bgImage.src =  backgroundImageURL;\r\n    }\r\n  }, [\r\n    canvas,\r\n    backgroundCanvas,\r\n    canvasHeight,\r\n    canvasWidth,\r\n    backgroundColor,\r\n    backgroundImageURL,\r\n    saveState,\r\n  ])\r\n\r\n  /**\r\n   * If state changed from undo/redo/reset, update user-facing canvas\r\n   */\r\n  useEffect(() => {\r\n    if (shouldReloadCanvas) {\r\n      canvas.loadFromJSON(currentState, () => {})\r\n    }\r\n  }, [canvas, shouldReloadCanvas, currentState])\r\n\r\n  /**\r\n   * Update canvas with selected tool\r\n   * PS: add initialDrawing in dependency so user drawing update reinits tool\r\n   */\r\n  useEffect(() => {\r\n    // Update canvas events with selected tool\r\n    const selectedTool = new tools[drawingMode](canvas) as FabricTool\r\n    const cleanupToolEvents = selectedTool.configureCanvas({\r\n      fillColor: fillColor,\r\n      strokeWidth: strokeWidth,\r\n      strokeColor: strokeColor,\r\n      displayRadius: displayRadius,\r\n \r\n      selectFillColor, // AARON rgba(255, 0, 0, 0.3)\r\n    })\r\n\r\n    canvas.on(\"mouse:up\", (e: any) => {\r\n      let selected = canvas.getObjects().indexOf(canvas.getActiveObject()) // AARON\r\n      const o: any = canvas.toJSON()\r\n\r\n      if (e[\"button\"] === 3 && drawingMode === 'select') { // AARON - Deselect\r\n        selected = -1\r\n        canvas.discardActiveObject().renderAll()\r\n      } else {\r\n        \r\n        // canvas.getActiveObject().set(\"fill\", '#ff0000').renderAll();\r\n      }\r\n\r\n      saveState({ ...o, selected }) // AARON NOTE... WHY is selected not getting saved in DrawableCanvasState ???\r\n      // saveState(canvas.toJSON()) // AARON\r\n\r\n      if (e[\"button\"] === 3 || drawingMode === 'select') { // AARON MODIFIED, NOTES: 3 = right click, 1 = left click, TBD selected object if any -1 to N, -1 == unselected\r\n        forceStreamlitUpdate()\r\n      }\r\n    })\r\n\r\n    canvas.on(\"mouse:dblclick\", () => {\r\n      // saveState(canvas.toJSON()) // AARON ?\r\n    })\r\n\r\n    // Cleanup tool + send data to Streamlit events\r\n    return () => {\r\n      cleanupToolEvents()\r\n      canvas.off(\"mouse:up\")\r\n      canvas.off(\"mouse:dblclick\")\r\n    }\r\n  }, [\r\n    canvas,\r\n    strokeWidth,\r\n    strokeColor,\r\n    displayRadius,\r\n    fillColor,\r\n    drawingMode,\r\n    initialDrawing,\r\n    saveState,\r\n    forceStreamlitUpdate,\r\n  ])\r\n\r\n  /**\r\n   * Render canvas w/ toolbar\r\n   */\r\n  return (\r\n    <div style={{ position: \"relative\" }}>\r\n      <div\r\n        style={{\r\n          position: \"absolute\",\r\n          top: 0,\r\n          left: 0,\r\n          zIndex: -10,\r\n          visibility: \"hidden\",\r\n        }}\r\n      >\r\n        <UpdateStreamlit\r\n          canvasHeight={canvasHeight}\r\n          canvasWidth={canvasWidth}\r\n          shouldSendToStreamlit={\r\n            realtimeUpdateStreamlit || forceSendToStreamlit\r\n          }\r\n          stateToSendToStreamlit={currentState}\r\n        />\r\n      </div>\r\n      <div\r\n        style={{\r\n          position: \"absolute\",\r\n          top: 0,\r\n          left: 0,\r\n          zIndex: 0,\r\n        }}\r\n      >\r\n        <canvas\r\n          id=\"backgroundimage-canvas\"\r\n          width={canvasWidth}\r\n          height={canvasHeight}\r\n        />\r\n      </div>\r\n      <div\r\n        style={{\r\n          position: \"absolute\",\r\n          top: 0,\r\n          left: 0,\r\n          zIndex: 10,\r\n        }}\r\n      >\r\n        <canvas\r\n          id=\"canvas\"\r\n          width={canvasWidth}\r\n          height={canvasHeight}\r\n          style={{ border: \"lightgrey 1px solid\" }}\r\n        />\r\n      </div>\r\n      {displayToolbar && (\r\n        <CanvasToolbar\r\n          topPosition={canvasHeight}\r\n          leftPosition={canvasWidth}\r\n          canUndo={canUndo}\r\n          canRedo={canRedo}\r\n          downloadCallback={forceStreamlitUpdate}\r\n          undoCallback={undo}\r\n          redoCallback={redo}\r\n          resetCallback={() => {\r\n            resetState(initialState)\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default withStreamlitConnection(DrawableCanvas)\r\n","import React from \"react\"\r\nimport ReactDOM from \"react-dom\"\r\nimport DrawableCanvas from \"./DrawableCanvas\"\r\nimport { CanvasStateProvider } from \"./DrawableCanvasState\"\r\n\r\nimport \"./index.css\"\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <CanvasStateProvider>\r\n      <DrawableCanvas />\r\n    </CanvasStateProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n)\r\n"],"sourceRoot":""}